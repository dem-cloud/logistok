
# ğŸ—‚ Table: store_plugins

---

Î‘Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ **Ï€Î¿Î¹Î± plugins ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î± ÏƒÎµ ÎºÎ¬Î¸Îµ store** Î¼Î¯Î±Ï‚ ÎµÏ„Î±Î¹ÏÎµÎ¯Î±Ï‚.  
Î•Î½Ï Î¿ Ï€Î¯Î½Î±ÎºÎ±Ï‚ `company_plugins` Î´Î·Î»ÏÎ½ÎµÎ¹ Ï€Î¿Î¹Î± plugins Î­Ï‡ÎµÎ¹ Î±Î³Î¿ÏÎ¬ÏƒÎµÎ¹/ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î· ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬, Î¿ Ï€Î¯Î½Î±ÎºÎ±Ï‚ `store_plugins` ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î· **Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… plugin ÏƒÎµ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ ÎºÎ±Ï„Î±ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚**.

Î•Î¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿Ï‚ ÏƒÎµ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± ÏŒÏ€Î¿Ï…:
- Î¼Î¹Î± ÎµÏ„Î±Î¹ÏÎµÎ¯Î± Î­Ï‡ÎµÎ¹ Ï€Î¿Î»Î»Î¬ stores,
- Î±Î»Î»Î¬ Ï„Î¿ plugin Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ ÏƒÎµ Î¼ÎµÏÎ¹ÎºÎ¬ Î±Ï€ÏŒ Î±Ï…Ï„Î¬  
  (Ï€.Ï‡. Fuel Station plugin Î¼ÏŒÎ½Î¿ ÏƒÏ„Î¿ Ï€ÏÎ±Ï„Î®ÏÎ¹Î¿, ÏŒÏ‡Î¹ ÏƒÏ„Î¿ mini market).

Î•Ï€Î¹Ï€Î»Î­Î¿Î½ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ **store-level settings**, ÏÏƒÏ„Îµ ÎºÎ¬Î¸Îµ store Î½Î± Î­Ï‡ÎµÎ¹ Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î® Ï€Î±ÏÎ±Î¼ÎµÏ„ÏÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… plugin.

**Works with:**
- `stores` â†’ Ï„Î¿ store ÏƒÏ„Î¿ Î¿Ï€Î¿Î¯Î¿ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ plugin
- `company_plugins` â†’ Ï„Î¿ plugin Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Î´Î¹ÎºÎ±Î¯Ï‰Î¼Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î· ÎµÏ„Î±Î¹ÏÎµÎ¯Î±
- `plugins` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ Ï„Î¿ global plugin definition
- `role_plugin_permissions` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ plugin permissions ÎµÏ†Î±ÏÎ¼ÏŒÎ¶Î¿Î½Ï„Î±Î¹ ÏŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ Ï„Î¿ plugin ÏƒÏ„Î¿ store
- `stock_movements` / `sales` / custom plugin tables â†’ plugin modules Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¾Î±ÏÏ„ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ store-level activation

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î±:
- ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·/Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· plugins Î±Î½Î¬ store,
- Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ® Ï€Î±ÏÎ±Î¼ÎµÏ„ÏÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… plugin Î±Î½Î¬ Ï…Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±,
- UI gating: Ï„Î¿ store â€œÎ²Î»Î­Ï€ÎµÎ¹â€ Î¼ÏŒÎ½Î¿ Ï„Î± modules Ï„Ï‰Î½ ÎµÎ½ÎµÏÎ³ÏÎ½ plugins Ï„Î¿Ï…,
- ÎµÏ€Î¹Ï‡ÎµÎ¹ÏÎ®ÏƒÎµÎ¹Ï‚ Î¼Îµ Ï€Î¿Î»Î»Î±Ï€Î»Î­Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ ÏƒÎµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¬ stores,
- granular feature control.

Î‘Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï„Î¿ â€œper-store plugin activation layerâ€, Î´Î·Î»Î±Î´Î® Ï„Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ **fine-grained Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± Î±Î½Î¬ ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±**.

---

## ğŸ“Œ 1. Fields Definition

| Field | Type | Null | Default | Description |
|--------|-------------|------|-----------|-------------|
| id (PK) | UUID | NOT NULL | gen_random_uuid() | Unique store-plugin record |
| company_plugin_id (FK) | UUID | NOT NULL | â€” | References company_plugins(id). Ensures the company owns the plugin |
| store_id (FK) | UUID | NOT NULL | â€” | References stores(id). Store where the plugin is enabled |
| settings | JSONB | NULL | â€” | Store-specific plugin settings |
| is_active | BOOLEAN | NOT NULL | TRUE | Whether the plugin is active |
| created_at | TIMESTAMP | NOT NULL | NOW() | Creation timestamp |

---

## Notes

- Defines which plugins are enabled per store.
- company_plugins = purchased plugins
- store_plugins = which stores use them
- settings allows per-store customization

---

## ğŸ“Œ 2. Example Rows

| id     | company_plugin_id | store_id  | settings                           | is_active | created_at          |
| ------ | ----------------- | --------- | ---------------------------------- | --------- | ------------------- |
| sp-001 | cp-1111           | store-aaa | {"pump_mapping": {"1": "Pump #1"}} | TRUE      | 2025-01-01 10:00:00 |
| sp-002 | cp-1111           | store-bbb | {"pump_mapping": {"2": "Pump #2"}} | TRUE      | 2025-01-01 10:05:00 |
| sp-003 | cp-2222           | store-ccc | {"size_chart": "EU"}               | TRUE      | 2025-01-02 09:00:00 |
| sp-004 | cp-3333           | store-aaa | NULL                               | FALSE     | 2025-01-03 12:30:00 |

---

## ğŸ“Œ 3. SQL: CREATE TABLE (Supabase)

```sql
CREATE TABLE store_plugins (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  company_plugin_id UUID NOT NULL REFERENCES company_plugins(id) ON DELETE CASCADE,
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  settings JSONB NULL,
  is_active BOOLEAN NOT NULL DEFAULT TRUE,
  created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE UNIQUE INDEX store_plugins_unique_pair
ON store_plugins (company_plugin_id, store_id);
```

---

## ğŸ“Œ 4. SQL: Insert Demo Data

```sql
INSERT INTO store_plugins
  (company_plugin_id, store_id, settings, is_active)
VALUES
  -- Fuel plugin enabled in two stores
  (
    'cp-1111',
    'store-aaa',
    '{"pump_mapping": {"1": "Pump #1"}}',
    TRUE
  ),
  (
    'cp-1111',
    'store-bbb',
    '{"pump_mapping": {"2": "Pump #2"}}',
    TRUE
  ),

  -- Clothing plugin enabled in store CCC
  (
    'cp-2222',
    'store-ccc',
    '{"size_chart": "EU"}',
    TRUE
  ),

  -- Disabled plugin for store AAA
  (
    'cp-3333',
    'store-aaa',
    NULL,
    FALSE
  );
```

