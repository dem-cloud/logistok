# ğŸ—‚ Table: purchases

---

Î‘Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ Î¼Î¯Î± **Î±Î³Î¿ÏÎ¬/Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½** Î±Ï€ÏŒ Ï€ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„Î® (vendor).  
ÎšÎ¬Î¸Îµ purchase ÎµÎ¯Î½Î±Î¹ Ï„Î¿ â€œÎºÎµÏ†Î±Î»Î¯â€ Ï„Î¿Ï… Ï€Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÎ¿Ï Î±Î³Î¿ÏÎ¬Ï‚ ÎºÎ±Î¹ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ­Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚, ÏŒÏ€Ï‰Ï‚ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±, vendor, Ï€Î¿ÏƒÏŒ ÎºÎ±Î¹ Ï„Î¿ store ÏƒÏ„Î¿ Î¿Ï€Î¿Î¯Î¿ ÎµÎ¹ÏƒÎ­ÏÏ‡ÎµÏ„Î±Î¹ Ï„Î¿ Î±Ï€ÏŒÎ¸ÎµÎ¼Î±.

ÎŸÎ¹ Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ­Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï„Î·Ï‚ Î±Î³Î¿ÏÎ¬Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± `purchase_items`.

**Works with:**
- `companies` â†’ Î· ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÏ„Î·Î½ Î¿Ï€Î¿Î¯Î± Î±Î½Î®ÎºÎµÎ¹ Î· Î±Î³Î¿ÏÎ¬
- `stores` â†’ ÏƒÎµ Ï€Î¿Î¹Î¿ ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± Ï€Î±ÏÎ±Î»Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î±Î¹ Ï„Î± Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î±
- `vendors` â†’ Î¿ Ï€ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„Î®Ï‚ Î±Ï€ÏŒ Ï„Î¿Î½ Î¿Ï€Î¿Î¯Î¿ Î­Î³Î¹Î½Îµ Î· Î±Î³Î¿ÏÎ¬
- `purchase_items` â†’ Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ­Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½ Ï„Î·Ï‚ Î±Î³Î¿ÏÎ¬Ï‚
- `product_variants` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ Ï„Î± variants Ï€Î¿Ï… Î±Î³Î¿ÏÎ¬Î¶Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î± purchase_items
- `stock_movements` â†’ ÎºÎ¬Î¸Îµ purchase Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ ÎµÎ¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½ÎµÏ‚ ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚ Î±Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚ (inbound stock)
- `store_products` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· quantity Î³Î¹Î± ÎºÎ¬Î¸Îµ variant ÏƒÏ„Î¿ store

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î±:
- Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï€Î±ÏÎ±Î»Î±Î²ÏÎ½ Î±Ï€Î¿Î¸Î®ÎºÎ·Ï‚,
- ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î±Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚ (increase),
- Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· ÎºÏŒÏƒÏ„Î¿Ï…Ï‚ Î±Î³Î¿ÏÎ¬Ï‚,
- accounting Ï‡ÏÎµÎ¹ÏÎ½ (Ï€.Ï‡. vendor statements),
- reports Î±Î³Î¿ÏÏÎ½ Î±Î½Î¬ vendor, store Î® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±.

ÎšÎ¬Î¸Îµ purchase ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î²Î±ÏƒÎ¹ÎºÏŒ record Ï€Î¿Ï… Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Î¼Î¹Î± ÎµÎ¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î· Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½.

---

## ğŸ“Œ 1. Fields Definition

| Field | Type | Null | Default | Description |
|--------|-----------|------|-----------|-------------|
| id (PK) | INT | NOT NULL | AUTO-INCREMENT | Unique purchase identifier |
| company_id (FK) | UUID | NOT NULL | â€” | References companies(id). Purchase belongs to a company |
| store_id (FK) | UUID | NOT NULL | â€” | References stores(id). Main store where the invoice belongs |
| vendor_id (FK) | UUID | NULL | â€” | References vendors(id) |
| payment_method_id (FK) | UUID | NOT NULL | â€” | References payment_methods(id) |
| invoice_number | TEXT | NULL | â€” | Supplier invoice number |
| invoice_date | DATE | NULL | â€” | Date of the supplier invoice |
| subtotal | NUMERIC(12,2) | NULL | â€” | Total before VAT |
| vat_total | NUMERIC(12,2) | NULL | â€” | Total VAT amount |
| total_amount | NUMERIC(12,2) | NOT NULL | â€” | Final amount to pay |
| notes | TEXT | NULL | â€” | Additional notes |
| status | TEXT | NOT NULL | 'completed' | Purchase status: 'completed', 'pending', 'cancelled' |
| created_by (FK) | UUID | NULL | â€” | References users(id). NULL = automated (e.g. plugin import) |
| created_at | TIMESTAMP | NOT NULL | NOW() | Creation timestamp |

---

## â„¹ï¸ Notes

- ÎšÎ¬Î¸Îµ purchase ÎµÎ¯Î½Î±Î¹ Î· **ÎºÎµÏ†Î±Î»Î¯Î´Î±** (header) ÎµÎ½ÏŒÏ‚ Ï€Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÎ¿Ï.
- Î¤Î± Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ¬ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± **purchase_items**.
- Î‘Ï€ÏŒ ÎºÎ¬Î¸Îµ purchase â†’ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½Ï„Î±Î¹ **stock movements** Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ items.
- `store_id` ÎµÎ´Ï ÎµÎ¯Î½Î±Î¹ Ï„Î¿ **Î»Î¿Î³Î¹ÏƒÏ„Î¹ÎºÏŒ store** ÏŒÏ€Î¿Ï… Î±Î½Î®ÎºÎµÎ¹ Ï„Î¿ Ï€Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÏŒ.
- Î‘Î½ Î­Î½Î± purchase Î­Ï‡ÎµÎ¹ items Ï€Î¿Ï… Ï€Î¬Î½Îµ ÏƒÎµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¬ stores â†’ Ï„Î¿ store_id ÏƒÏ„Î± items ÎµÎ¯Î½Î±Î¹ Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„ÏŒ.

---

## ğŸ“Œ 2. Example Rows

| id  | company_id | store_id  | vendor_id | payment_method_id | invoice_number | invoice_date | subtotal | vat_total | total_amount | notes                               | status      | created_by | created_at          |
| --- | ---------- | --------- | --------- | ----------------- | -------------- | ------------ | -------- | --------- | ------------ | ----------------------------------- | ----------- | ---------- | ------------------- |
| 100 | comp-1111  | store-aaa | vend-001  | paym-001          | A-5542       | 2025-01-01   | 348.00   | 83.52     | 431.52       | Î Î±ÏÎ±Î»Î±Î²Î® Î¬Î¼Î¼Î¿Ï…                    | completed | user-111   | 2025-01-01 12:00:00 |
| 101 | comp-1111  | store-aaa | vend-005  | paym-002          | INV-9981     | 2025-01-02   | 90.00    | 21.60     | 111.60       | NULL                                | completed | user-111   | 2025-01-02 09:10:00 |
| 102 | comp-2222  | store-bbb | NULL      | paym-001          | NULL           | NULL         | 150.00   | 36.00     | 186.00       | Î§Ï‰ÏÎ¯Ï‚ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ (Ï€.Ï‡. Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹ÎµÏ‚) | pending   | user-222   | 2025-01-03 10:00:00 |

---

## ğŸ“Œ 3. SQL: CREATE TABLE (Supabase)

```sql
CREATE TABLE purchases (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

  company_id UUID NOT NULL REFERENCES companies(id) ON DELETE CASCADE,
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  vendor_id UUID NULL REFERENCES vendors(id) ON DELETE SET NULL,
  payment_method_id UUID NOT NULL REFERENCES payment_methods(id) ON DELETE RESTRICT,

  invoice_number TEXT NULL,
  invoice_date DATE NULL,

  subtotal NUMERIC(12,2) NULL,
  vat_total NUMERIC(12,2) NULL,
  total_amount NUMERIC(12,2) NOT NULL CHECK (total_amount >= 0),

  notes TEXT NULL,
  status TEXT NOT NULL DEFAULT 'completed' CHECK (status IN ('draft', 'ordered', 'received', 'completed', 'cancelled')),

  created_by UUID NULL REFERENCES users(id) ON DELETE SET NULL,

  created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE UNIQUE INDEX purchases_unique_invoice_number_per_company
ON purchases (company_id, invoice_number)
WHERE invoice_number IS NOT NULL;

CREATE INDEX idx_purchases_company_id ON purchases(company_id);
CREATE INDEX idx_purchases_store_id ON purchases(store_id);
CREATE INDEX idx_purchases_vendor_id ON purchases(vendor_id);
CREATE INDEX idx_purchases_payment_method_id ON purchases(payment_method_id);
CREATE INDEX purchases_invoice_date_idx ON purchases (invoice_date);
CREATE INDEX idx_purchases_created_by ON purchases(created_by);
```

---

## ğŸ“Œ 4. SQL: Insert Demo Data

```sql
INSERT INTO purchases
  (company_id, store_id, vendor_id, payment_method_id, invoice_number, invoice_date,
   subtotal, vat_total, total_amount, notes, status, created_by)
VALUES
  -- Example 1: Purchase with full invoice
  (
    'comp-1111',
    'store-aaa',
    'vend-001',
    'paym-001',
    'A-5542',
    '2025-01-01',
    348.00,
    83.52,
    431.52,
    'Î Î±ÏÎ±Î»Î±Î²Î® Î¬Î¼Î¼Î¿Ï…',
    'completed',
    'user-111'
  ),

  -- Example 2: Different vendor, card payment
  (
    'comp-1111',
    'store-aaa',
    'vend-005',
    'paym-002',
    'INV-9981',
    '2025-01-02',
    90.00,
    21.60,
    111.60,
    NULL,
    'completed',
    'user-111'
  ),

  -- Example 3: Purchase without vendor (e.g. expenses)
  (
    'comp-2222',
    'store-bbb',
    NULL,
    'paym-001',
    NULL,
    NULL,
    150.00,
    36.00,
    186.00,
    'Î§Ï‰ÏÎ¯Ï‚ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ (Ï€.Ï‡. Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹ÎµÏ‚)',
    'pending',
    'user-222'
  );
```