# ðŸ—‚ Table: purchase_items

---

Î‘Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ Ï„Î¹Ï‚ **Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½** Î¼Î­ÏƒÎ± ÏƒÎµ Î¼Î¯Î± Î±Î³Î¿ÏÎ¬ (purchase).  
ÎšÎ¬Î¸Îµ Î³ÏÎ±Î¼Î¼Î® Î±Ï†Î¿ÏÎ¬ **ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ variant Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚** ÎºÎ±Î¹ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î±, Ï„Î¹Î¼Î® Î±Î³Î¿ÏÎ¬Ï‚ ÎºÎ±Î¹ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚.

Î•Î¯Î½Î±Î¹ Î¿ Î±Î½Î±Î»Ï…Ï„Î¹ÎºÏŒÏ‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Ï„Ï‰Î½ Î±Î³Î¿ÏÏŽÎ½ ÎºÎ±Î¹ Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï„Î· Î²Î¬ÏƒÎ· Î³Î¹Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î±Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚, ÎºÏŒÏƒÏ„Î¿Ï‚ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½ ÎºÎ±Î¹ reports.

**Works with:**
- `purchases` â†’ Ï„Î¿ parent purchase ÏƒÏ„Î¿ Î¿Ï€Î¿Î¯Î¿ Î±Î½Î®ÎºÎµÎ¹ Ï„Î¿ item
- `product_variants` â†’ Ï€Î¿Î¹Î¿ variant Î±Î³Î¿ÏÎ¬ÏƒÏ„Î·ÎºÎµ
- `units` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ Î· Î¼Î¿Î½Î¬Î´Î± Î¼Î­Ï„ÏÎ·ÏƒÎ·Ï‚ Ï„Î¿Ï… variant
- `store_products` â†’ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· quantity Î³Î¹Î± Ï„Î¿ store Ï€Î¿Ï… Î±Ï†Î¿ÏÎ¬ Î· Î±Î³Î¿ÏÎ¬
- `stock_movements` â†’ ÎºÎ¬Î¸Îµ purchase item Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ ÎµÎ¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î· stock movement
- `vendors` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ Î¿ Ï€ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„Î®Ï‚ ÏƒÏ…Î½Î´Î­ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ parent purchase

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î±:
- ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î±Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚ (stock increase),
- ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î® ÎºÏŒÏƒÏ„Î¿Ï…Ï‚ Î±Î³Î¿ÏÎ¬Ï‚ Î±Î½Î¬ variant,
- Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ Î±Î¾Î¯Î±Ï‚ Î±Ï€Î¿Î¸Î®ÎºÎ·Ï‚,
- auditing Ï„Î¹Î¼ÏŽÎ½ ÎºÎ±Î¹ cost history,
- Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ­Ï‚ Î±Î½Î±Ï†Î¿ÏÎ­Ï‚ Î±Î³Î¿ÏÏŽÎ½.

Î‘Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï„Î¿ â€œdetailed line-levelâ€ ÎºÎ¿Î¼Î¼Î¬Ï„Î¹ ÎºÎ¬Î¸Îµ Î±Î³Î¿ÏÎ¬Ï‚.

---

## ðŸ“Œ 1. Fields Definition

| Field | Type | Null | Default | Description |
|--------|-----------|------|-----------|-------------|
| id (PK) | INT | NOT NULL | AUTO-INCREMENT | Unique purchase item identifier |
| purchase_id (FK) | INT | NOT NULL | â€” | References purchases(id) |
| product_id (FK) | INT | NOT NULL | â€” | References products(id) |
| product_variant_id (FK) | INT | NOT NULL | â€” | References product_variants(id) |
| quantity | NUMERIC(12,3) | NOT NULL | â€” | Quantity purchased |
| cost_price | NUMERIC(10,2) | NOT NULL | â€” | Cost per unit at the time of purchase |
| total_cost | NUMERIC(12,2) | NOT NULL | â€” | quantity Ã— cost_price |
| created_at | TIMESTAMP | NOT NULL | NOW() | Creation timestamp |

---

## â„¹ï¸ Notes

- ÎšÎ¬Î¸Îµ purchase Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï€Î¿Î»Î»Î¬ items.
- Î‘Ï€ÏŒ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± stock movement ÏƒÏ„Î¿ `stock_movements`.

---

## ðŸ“Œ 2. Example Rows

| id | purchase_id | product_id | product_variant_id | quantity | cost_price | total_cost | created_at          |
| -- | ----------- | ---------- | ------------------ | -------- | ---------- | ---------- | ------------------- |
| 1  | 100         | 10         | 1                  | 100.000  | 2.40       | 240.00     | 2025-01-01 12:00:00 |
| 2  | 100         | 10         | 2                  | 1.000    | 42.00      | 42.00      | 2025-01-01 12:00:01 |
| 3  | 101         | 21         | 4                  | 15.000   | 7.20       | 108.00     | 2025-01-02 09:15:00 |
| 4  | 102         | 22         | 5                  | 50.000   | 3.50       | 175.00     | 2025-01-02 10:00:00 |

---

## ðŸ“Œ 3. SQL: CREATE TABLE (Supabase)

```sql
CREATE TABLE purchase_items (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

  purchase_id BIGINT NOT NULL REFERENCES purchases(id) ON DELETE CASCADE,

  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE RESTRICT,
  product_variant_id BIGINT NOT NULL REFERENCES product_variants(id) ON DELETE RESTRICT,

  quantity NUMERIC(12,3) NOT NULL CHECK (quantity > 0),
  cost_price NUMERIC(10,2) NOT NULL,
  total_cost NUMERIC(12,2) GENERATED ALWAYS AS (quantity * cost_price) STORED,

  created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_purchase_items_purchase_id ON purchase_items(purchase_id);
CREATE INDEX idx_purchase_items_product_id ON purchase_items(product_id);
CREATE INDEX idx_purchase_items_variant_id ON purchase_items(product_variant_id);
```

---

## ðŸ“Œ 4. SQL: Insert Demo Data

```sql
INSERT INTO purchase_items
  (purchase_id, product_id, product_variant_id, quantity, cost_price, total_cost)
VALUES
  -- Purchase of sand 25kg bags
  (
    100,
    10,
    1,
    100.000,
    2.40,
    240.00
  ),

  -- Purchase of sand 1 Ton
  (
    100,
    10,
    2,
    1.000,
    42.00,
    42.00
  ),

  -- Purchase of red paint
  (
    101,
    21,
    4,
    15.000,
    7.20,
    108.00
  ),

  -- Purchase of olive oil (single default variant)
  (
    102,
    22,
    5,
    50.000,
    3.50,
    175.00
  );
```