# ğŸ—‚ Table: company_plugins

---

Î‘Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ **Ï€Î¿Î¹Î± plugins/addons Î­Ï‡ÎµÎ¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î® Î±Î³Î¿ÏÎ¬ÏƒÎµÎ¹ Î¼Î¯Î± ÎµÏ„Î±Î¹ÏÎµÎ¯Î±**.  
ÎšÎ¬Î¸Îµ row Î´Î·Î»ÏÎ½ÎµÎ¹ ÏŒÏ„Î¹ Î¼Î¹Î± ÎµÏ„Î±Î¹ÏÎµÎ¯Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î­Î½Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ plugin â€” ÎµÎ¯Ï„Îµ Î´Ï‰ÏÎµÎ¬Î½, ÎµÎ¯Ï„Îµ Î¼Î­ÏƒÏ‰ ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚, ÎµÎ¯Ï„Îµ Î¼Î­ÏƒÏ‰ extra Ï‡ÏÎ­Ï‰ÏƒÎ·Ï‚.

ÎŸ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ Î· â€œÎºÏÏÎ¹Î± Î»Î¯ÏƒÏ„Î±â€ ÎµÎ½ÎµÏÎ³ÏÎ½ plugins Î³Î¹Î± ÎºÎ¬Î¸Îµ ÎµÏ„Î±Î¹ÏÎµÎ¯Î±.

**Works with:**
- `companies` â†’ Î· ÎµÏ„Î±Î¹ÏÎµÎ¯Î± Ï€Î¿Ï… ÎºÎ±Ï„Î­Ï‡ÎµÎ¹ Ï„Î¿ plugin
- `plugins` â†’ Ï€Î¿Î¹Î¿ plugin ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ
- `subscription_items` â†’ Ï„Î¿ billing line Ï„Î¿Ï… plugin (addon billing, Stripe item)
- `store_plugins` â†’ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·/ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… plugin Î±Î½Î¬ store (store-level availability)
- `role_plugin_permissions` â†’ permissions Ï€Î¿Ï… ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± ÏÏŒÎ»Î¿Ï…Ï‚ ÏŒÏ„Î±Î½ Ï„Î¿ plugin ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î±:
- Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ·/Î±Î³Î¿ÏÎ¬ plugins,
- ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½ ÏƒÏ„Î¿ UI,
- ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· permissions Î±Î½Î¬ ÏÏŒÎ»Î¿,
- billing integration Î¼Îµ Stripe (Î¼Î­ÏƒÏ‰ subscription items),
- Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· plugin-level settings Î³Î¹Î± Ï„Î·Î½ ÎµÏ„Î±Î¹ÏÎµÎ¯Î±.

Î‘Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï„Î¿Î½ Ï€Ï…ÏÎ®Î½Î± Ï„Î¿Ï… plugin system, ÎºÎ±Î¸ÏÏ‚ ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ *Ï€Î¿Î¹Î± features Î­Ï‡ÎµÎ¹ ÎµÎ½ÎµÏÎ³Î¬ Î¼Î¹Î± ÎµÏ„Î±Î¹ÏÎµÎ¯Î±* ÏƒÏ„Î¿ SaaS.

**SOS**
UUID Î¼ÏŒÎ½Î¿ ÏŒÏ„Î±Î½ Ï„Î¿ record Î­Ï‡ÎµÎ¹ Î´Î¹ÎºÎ® Ï„Î¿Ï… Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±.
Associations â†’ composite PK.

---

## ğŸ“Œ 1. Fields Definition

| Field | Type | Null | Default | Description |
|-------|-------|------|---------|-------------|
| id (PK) | UUID | NOT NULL | gen_random_uuid() | Unique identifier for the company-plugin installation |
| company_id (FK) | UUID | NOT NULL | â€” | References companies(id) |
| plugin_key (FK) | TEXT | NOT NULL | â€” | References plugins(plugin_key) |
| subscription_item_id (FK) | UUID | NULL | â€” | References subscription_items(id) |
| is_active | BOOLEAN | NOT NULL | TRUE | Whether the plugin is active for this company |
| activated_at | TIMESTAMP | NOT NULL | NOW() | When the plugin was activated |
| deactivated_at | TIMESTAMP | NULL | â€” | When the plugin was deactivated (soft disable) |
| settings | JSONB | NULL | â€” | Plugin-specific settings for this company |
| created_at | TIMESTAMP | NOT NULL | NOW() | Creation timestamp |

---

## ğŸ“Œ 2. Example Rows

| id     | company_id | plugin_key   | subscription_item_id | is_active | activated_at        | deactivated_at      | settings              | created_at          |
| ------ | ---------- | ------------ | -------------------- | --------- | ------------------- | ------------------- | --------------------- | ------------------- |
| cp-001 | comp-1111  | fuel_station | subitem-111          | TRUE      | 2025-01-01 10:00:00 | NULL                | {"auto_sync": true}   | 2025-01-01 10:00:00 |
| cp-002 | comp-1111  | reporting    | NULL                 | TRUE      | 2025-01-01 10:02:00 | NULL                | {}                    | 2025-01-01 10:02:00 |
| cp-003 | comp-2222  | clothing     | subitem-222          | TRUE      | 2025-01-01 10:05:00 | NULL                | {"size_matrix": "EU"} | 2025-01-01 10:05:00 |
| cp-004 | comp-3333  | fuel_station | subitem-333          | FALSE     | 2025-01-01 10:10:00 | 2025-02-01 09:00:00 | NULL                  | 2025-01-01 10:10:00 |

---

## ğŸ“Œ 3. SQL: CREATE TABLE (Supabase)

```sql
CREATE TABLE company_plugins (
  company_id UUID NOT NULL REFERENCES companies(id) ON DELETE CASCADE,
  plugin_key TEXT NOT NULL REFERENCES plugins(key) ON DELETE CASCADE,

  subscription_item_id UUID NULL REFERENCES subscription_items(id) ON DELETE CASCADE,

  is_active BOOLEAN NOT NULL DEFAULT TRUE,
  activated_at TIMESTAMP NOT NULL DEFAULT NOW(),
  deactivated_at TIMESTAMP NULL,

  settings JSONB NULL,

  created_at TIMESTAMP NOT NULL DEFAULT NOW()

  PRIMARY KEY (company_id, plugin_key)
);

CREATE UNIQUE INDEX company_plugins_unique_company_plugin
ON company_plugins (company_id, plugin_key);

CREATE INDEX idx_company_plugins_company_id ON company_plugins(company_id);
CREATE INDEX idx_company_plugins_plugin_key ON company_plugins(plugin_key);
CREATE INDEX idx_company_plugins_active ON company_plugins(company_id, is_active); --?
```

---

## ğŸ“Œ 4. SQL: Insert Demo Data

```sql
INSERT INTO company_plugins
  (company_id, plugin_key, subscription_item_id, is_active, activated_at, deactivated_at, settings)
VALUES
  -- Î•Ï„Î±Î¹ÏÎµÎ¯Î± 1 Î±Î³Î¿ÏÎ¬Î¶ÎµÎ¹ Ï„Î¿ fuel station plugin Î¼Î­ÏƒÏ‰ subscription
  ('comp-1111', 'fuel_station', 'subitem-111', TRUE, NOW(), NULL, '{"auto_sync": true}'),

  -- Î•Ï„Î±Î¹ÏÎµÎ¯Î± 1 Î­Ï‡ÎµÎ¹ ÎºÎ±Î¹ reporting plugin (Î´Ï‰ÏÎµÎ¬Î½ Î® global)
  ('comp-1111', 'reporting', NULL, TRUE, NOW(), NULL, '{}'::jsonb),

  -- Î•Ï„Î±Î¹ÏÎµÎ¯Î± 2, plugin Î³Î¹Î± ÏÎ¿ÏÏ‡Î± (Ï€.Ï‡. size matrix)
  ('comp-2222', 'clothing', 'subitem-222', TRUE, NOW(), NULL, '{"size_matrix": "EU"}'),

  -- Î•Ï„Î±Î¹ÏÎµÎ¯Î± 3 ÎµÎ¯Ï‡Îµ plugin Î±Î»Î»Î¬ Ï„Î¿ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ
  ('comp-3333', 'fuel_station', 'subitem-333', FALSE, NOW(), '2025-02-01 09:00:00', NULL);
```