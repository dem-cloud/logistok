# ğŸ—‚ Table: sale_items

---

Î‘Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ Ï„Î¹Ï‚ **Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½** Î¼Î­ÏƒÎ± ÏƒÎµ Î¼Î¯Î± Ï€ÏÎ»Î·ÏƒÎ· (sale).  
ÎšÎ¬Î¸Îµ Î³ÏÎ±Î¼Î¼Î® Î±Ï†Î¿ÏÎ¬ Î­Î½Î± **ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ product variant**, Î¼Îµ Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î±, Ï„Î¹Î¼Î® Ï€ÏÎ»Î·ÏƒÎ·Ï‚, Î­ÎºÏ€Ï„Ï‰ÏƒÎ· ÎºÎ±Î¹ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ® Î±Î¾Î¯Î±.  
Î•Î¯Î½Î±Î¹ Î¿ Î±Î½Î±Î»Ï…Ï„Î¹ÎºÏŒÏ‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Ï€Î¯ÏƒÏ‰ Î±Ï€ÏŒ ÎºÎ¬Î¸Îµ Î±Ï€ÏŒÎ´ÎµÎ¹Î¾Î·/Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ Î® POS ÏƒÏ…Î½Î±Î»Î»Î±Î³Î®.

**Works with:**
- `sales` â†’ Ï„Î¿ parent sale ÏƒÏ„Î¿ Î¿Ï€Î¿Î¯Î¿ Î±Î½Î®ÎºÎµÎ¹ Ï„Î¿ item
- `product_variants` â†’ Ï€Î¿Î¹Î¿ variant Ï€Ï‰Î»Î®Î¸Î·ÎºÎµ
- `units` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ Î¼Î¿Î½Î¬Î´Î± Î¼Î­Ï„ÏÎ·ÏƒÎ·Ï‚ Ï„Î¿Ï… variant
- `store_products` â†’ Î¼ÎµÎ¯Ï‰ÏƒÎ· Î±Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚ ÏƒÏ„Î¿ store ÎºÎ±Ï„Î¬ Ï„Î·Î½ Ï€ÏÎ»Î·ÏƒÎ·
- `stock_movements` â†’ ÎºÎ¬Î¸Îµ sale item Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ outbound stock movement
- `products` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ Ï„Î¿ item Î±Î½Î®ÎºÎµÎ¹ ÏƒÎµ variant Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Î±Î½Î®ÎºÎµÎ¹ ÏƒÎµ product
- `customers` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ Î¿ Ï€ÎµÎ»Î¬Ï„Î·Ï‚ Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ parent sale (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹)

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î±:
- POS Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÎºÎ±Î¹ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·,
- Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ­Ï‚ Ï€Ï‰Î»Î®ÏƒÎµÎ¹Ï‚ Î±Î½Î¬ Ï€ÏÎ¿ÏŠÏŒÎ½/variant,
- ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î±Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚ (stock decrease),
- reports Ï€Ï‰Î»Î®ÏƒÎµÏ‰Î½ (ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚, Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î±, stores, Ï€Î¿ÏƒÏŒÏ„Î·Ï„ÎµÏ‚),
- Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏÎ½ Ï€Î¿ÏƒÏÎ½ ÎºÎ±Î¹ ÎµÎºÏ€Ï„ÏÏƒÎµÏ‰Î½.

ÎšÎ¬Î¸Îµ sale item ÎµÎ¯Î½Î±Î¹ Î¼Î¯Î± Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎ®Ï‚ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î® â€œÏ„Î¹ Î±ÎºÏÎ¹Î²ÏÏ‚ Ï€Î¿Ï…Î»Î®Î¸Î·ÎºÎµâ€ ÏƒÏ„Î· ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· ÏƒÏ…Î½Î±Î»Î»Î±Î³Î®.

---

## ğŸ“Œ 1. Fields Definition

| Field | Type | Null | Default | Description |
|--------|-----------|------|-----------|-------------|
| id (PK) | INT | NOT NULL | AUTO-INCREMENT | Unique sale item identifier |
| sale_id (FK) | INT | NOT NULL | â€” | References sales(id). Parent sale/receipt |
| product_id (FK) | INT | NOT NULL | â€” | References products(id) |
| product_variant_id (FK) | INT | NOT NULL | â€” | References product_variants(id). NULL only if product has no variants |
| quantity | NUMERIC(12,3) | NOT NULL | â€” | Quantity sold |
| sale_price | NUMERIC(10,2) | NOT NULL | â€” | Final price per unit at the time of sale |
| total_price | NUMERIC(12,2) | NOT NULL | â€” | (sale_price - discount) Ã— quantity |
| created_at | TIMESTAMP | NOT NULL | NOW() | Creation timestamp |

---

## ğŸ“Œ 2. Example Rows

| id | sale_id | product_id | product_variant_id | quantity | sale_price | total_price | created_at          |
| -- | ------- | ---------- | ------------------ | -------- | ---------- | ----------- | ------------------- |
| 1  | 500     | 10         | 1                  | 3.000    | 3.20       | 9.60        | 2025-01-05 10:00:00 |
| 2  | 500     | 21         | 4                  | 1.000    | 12.50      | 12.50       | 2025-01-05 10:00:01 |
| 3  | 501     | 22         | 5                  | 2.000    | 5.00       | 10.00       | 2025-01-05 11:20:00 |
| 4  | 502     | 10         | 2                  | 0.200    | 50.00      | 10.00       | 2025-01-05 12:00:00 |

Î¤Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± 4 Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ Ï‡ÏÎ¼Î± Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î± (0.200 Ton Ã— 50â‚¬ = 10â‚¬)

---

## ğŸ“Œ 3. SQL: CREATE TABLE (Supabase)

```sql
CREATE TABLE sale_items (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

  sale_id BIGINT NOT NULL REFERENCES sales(id) ON DELETE CASCADE,

  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE RESTRICT,
  product_variant_id BIGINT NOT NULL REFERENCES product_variants(id) ON DELETE RESTRICT,

  quantity NUMERIC(12,3) NOT NULL CHECK (quantity > 0),
  sale_price NUMERIC(12,2) NOT NULL CHECK (sale_price >= 0),
  total_price NUMERIC(12,2) GENERATED ALWAYS AS (sale_price * quantity) STORED,

  created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_sale_items_sale_id ON sale_items(sale_id);
CREATE INDEX idx_sale_items_product_id ON sale_items(product_id);
CREATE INDEX idx_sale_items_variant_id ON sale_items(product_variant_id);
```

---

## ğŸ“Œ 4. SQL: Insert Demo Data

```sql
INSERT INTO sale_items
  (sale_id, product_id, product_variant_id, quantity, sale_price, total_price)
VALUES
  -- Sale: 3 ÏƒÎ±ÎºÎ¿Ï…Î»Î¬ÎºÎ¹Î± Î¬Î¼Î¼Î¿Ï… 25kg
  (
    500,
    10,
    1,
    3.000,
    3.20,
    9.60
  ),

  -- Sale: 1 ÎºÎ¿Ï…Ï„Î¯ Î¼Ï€Î¿Î³Î¹Î¬Ï‚
  (
    500,
    21,
    4,
    1.000,
    12.50,
    12.50
  ),

  -- Sale: 2 Ï„ÎµÎ¼Î¬Ï‡Î¹Î± ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿
  (
    501,
    22,
    5,
    2.000,
    5.00,
    10.00
  ),

  -- Sale: 0.2 Ton Î¬Î¼Î¼Î¿Ï‚ Ï‡ÏÎ¼Î±
  (
    502,
    10,
    2,
    0.200,
    50.00,
    10.00
  );
```