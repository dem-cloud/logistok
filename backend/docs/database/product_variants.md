# ðŸ—‚ Table: product_variants

---

Î‘Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ Ï„Î¹Ï‚ **Ï€Î±ÏÎ±Î»Î»Î±Î³Î­Ï‚ (variants)** ÎµÎ½ÏŒÏ‚ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚.  
ÎšÎ¬Î¸Îµ Ï€ÏÎ¿ÏŠÏŒÎ½ Î­Ï‡ÎµÎ¹ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ **Î­Î½Î± variant**, Î±ÎºÏŒÎ¼Î· ÎºÎ¹ Î±Î½ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ­Ï‚ Ï€Î±ÏÎ±Î»Î»Î±Î³Î­Ï‚ (Ï€.Ï‡. Î¼Î¿Î½Î±Î´Î¹ÎºÏŒ barcode, Î¼Î¿Î½Î±Î´Î¹ÎºÎ® Î¼Î¿Î½Î¬Î´Î±).  
ÎŸÎ¹ Ï€Î±ÏÎ±Î»Î»Î±Î³Î­Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Î´Î¹Î±Ï†Î¿ÏÎ­Ï‚ ÏƒÎµ Î¼Î­Î³ÎµÎ¸Î¿Ï‚, ÏƒÏ…ÏƒÎºÎµÏ…Î±ÏƒÎ¯Î±, Î²Î¬ÏÎ¿Ï‚, barcode, SKU, Ï„Î¹Î¼Î­Ï‚ Îº.Î»Ï€.

**Works with:**
- `products` â†’ Ï„Î¿ parent Ï€ÏÎ¿ÏŠÏŒÎ½ ÏƒÏ„Î¿ Î¿Ï€Î¿Î¯Î¿ Î±Î½Î®ÎºÎµÎ¹ Ï„Î¿ variant
- `units` â†’ Î¼Î¿Î½Î¬Î´Î± Î¼Î­Ï„ÏÎ·ÏƒÎ·Ï‚ Î³Î¹Î± Ï„Î¿ variant (kg, L, Ï„ÎµÎ¼Î¬Ï‡Î¹Î±, 25kg sack, ton Îº.Î»Ï€.)
- `store_products` â†’ quantity/stock Î±Î½Î¬ variant ÎºÎ±Î¹ Î±Î½Î¬ store
- `sale_items` â†’ Î³ÏÎ±Î¼Î¼Î® Ï€ÏŽÎ»Î·ÏƒÎ·Ï‚ Î±Ï†Î¿ÏÎ¬ Ï€Î¬Î½Ï„Î± Î­Î½Î± variant
- `purchase_items` â†’ Î³ÏÎ±Î¼Î¼Î® Î±Î³Î¿ÏÎ¬Ï‚ Î±Ï†Î¿ÏÎ¬ Ï€Î¬Î½Ï„Î± Î­Î½Î± variant
- `stock_movements` â†’ ÏŒÎ»ÎµÏ‚ Î¿Î¹ ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚ Î±Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚ Î±Ï†Î¿ÏÎ¿ÏÎ½ variant, ÏŒÏ‡Î¹ product
- `company_plugins` (Î­Î¼Î¼ÎµÏƒÎ±) â†’ plugins Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Ï…Î½ custom variant fields (Ï€.Ï‡. fuel octane, clothing sizes)

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î±:
- barcode-level stock tracking,
- Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï€Î¿Î»Î»ÏŽÎ½ Ï„ÏÏ€Ï‰Î½ ÏƒÏ…ÏƒÎºÎµÏ…Î±ÏƒÎ¯Î±Ï‚ (Ï€.Ï‡. 25kg / 40kg / Ï‡ÏÎ¼Î±),
- variant-level pricing (cost_price, sale_price),
- SKU Î´Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒ ÏƒÎµ POS ÎºÎ±Î¹ ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï…Ï‚,
- inventory accuracy Î±Î½Î¬ store.

Î•Î¯Î½Î±Î¹ Î¿ Ï€Î¹Î¿ ÎºÏÎ¯ÏƒÎ¹Î¼Î¿Ï‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Î³Î¹Î± Î±ÎºÏÎ¹Î²Î® Î±Ï€Î¿Î¸Î®ÎºÎ·, ÎºÎ±Î¸ÏŽÏ‚ ÏŒÎ»Î± Ï„Î± stock, sales ÎºÎ±Î¹ purchases Î³Î¯Î½Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ variant.

---

## ðŸ“Œ 1. Fields Definition

| Field | Type | Null | Default | Description |
|--------|---------|------|----------|-------------|
| id (PK) | INT | NOT NULL | AUTO-INCREMENT | Unique product variant identifier |
| product_id (FK) | INT | NOT NULL | â€” | References products(id). Parent product |
| name | TEXT | NOT NULL | â€” | Variant name (e.g., "25kg", "1 Ton", "XL", "Red") |
| sku | TEXT | NULL | â€” | Unique internal SKU for variant (optional) |
| barcode | TEXT | NULL | â€” | Barcode for the specific variant (optional override) |
| cost_price | NUMERIC(10,2) | NULL | â€” | Cost price of the variant (company-level) (optional field, the actual cost price is on the purchase_items) |
| created_at | TIMESTAMP | NOT NULL | NOW() | When the variant was created |

---

## â„¹ï¸ Important Notes

- ÎšÎ¬Î¸Îµ product Î­Ï‡ÎµÎ¹ **Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 1 variant** â€” Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î±Î½ Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ â€œDefaultâ€.

---

## ðŸ“Œ 2. Example Rows

| id | product_id | name      | sku         | barcode         | cost_price | created_at          |
| -- | ---------- | --------- | ----------- | --------------- | ---------- | ------------------- |
| 1  | 10         | 25kg    | SAND-25KG | 5201234567890 | 2.40       | 2025-01-01 10:00:00 |
| 2  | 10         | 1 Ton   | SAND-1TON | NULL            | 42.00      | 2025-01-01 10:00:01 |
| 3  | 20         | XL      | TSHIRT-XL | 9876543210001 | NULL       | 2025-01-01 10:00:02 |
| 4  | 21         | Red     | NULL        | 1112223334445 | 7.20       | 2025-01-01 10:00:03 |
| 5  | 22         | Default | NULL        | NULL            | NULL       | 2025-01-01 10:00:04 |

---

## ðŸ“Œ 3. SQL: CREATE TABLE (Supabase)

```sql
CREATE TABLE product_variants (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,

  name TEXT NOT NULL,
  sku TEXT NULL,
  barcode TEXT NULL,

  cost_price NUMERIC(12,2) NULL CHECK (cost_price >= 0),

  created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE UNIQUE INDEX product_variants_unique_sku
ON product_variants (sku)
WHERE sku IS NOT NULL;

CREATE UNIQUE INDEX product_variants_unique_barcode
ON product_variants (barcode)
WHERE barcode IS NOT NULL;

CREATE UNIQUE INDEX product_variants_unique_name_per_product
ON product_variants (product_id, name);

CREATE INDEX idx_product_variants_product_id ON product_variants(product_id);
CREATE INDEX idx_product_variants_is_active ON product_variants(product_id, is_active); --?
```

---

## ðŸ“Œ 4. SQL: Insert Demo Data

```sql
INSERT INTO product_variants
  (product_id, name, sku, barcode, cost_price)
VALUES
  -- Variants for "Sand"
  (10, '25kg', 'SAND-25KG', '5201234567890', 2.40),
  (10, '1 Ton', 'SAND-1TON', NULL, 42.00),

  -- Clothing variant example
  (20, 'XL', 'TSHIRT-XL', '9876543210001', NULL),

  -- Color variant
  (21, 'Red', NULL, '1112223334445', 7.20),

  -- Default variant for a product with no variations
  (22, 'Default', NULL, NULL, NULL);
```